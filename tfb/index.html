<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <title>TFB Labs</title>

    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap/dist/css/bootstrap.min.css" />
    <link type="text/css" rel="stylesheet" href="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.css" />

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es2015%2CIntersectionObserver"></script>
    <script src="https://unpkg.com/vue@latest/dist/vue.js"></script>
    <script src="https://unpkg.com/bootstrap-vue@latest/dist/bootstrap-vue.js"></script>
    <script src="./wallet.js"></script>
  </head>
  <body>
    <div id="app">
      <b-container>
        <b-navbar toggleable="lg">
          <b-navbar-brand href="#">Truefeedback Labs</b-navbar-brand>
        </b-navbar>
        
        <b-tabs class="mt-2" content-class="mt-3">
          <b-tab title="Assets" active>
            <div>
              <div class="row">
                <div class="col-8">
                  {{ tfbBalance }} TFB
                </div>
                <div class="col-4">
                  aaa
                </div>
              </div>
              <div class="row">
                <div class="col-8">
                  {{ celoBalance }} CELO
                </div>
                <div class="col-4">
                  aaa
                </div>
              </div>
              <div class="row">
                <div class="col-8">
                  {{ cUsdBalance }} cUSD
                </div>
                <div class="col-4">
                  aaa
                </div>
              </div>
            </div>
          </b-tab>
          <b-tab title="Transaction History">
            <p>I'm the second tab</p>
          </b-tab>
          <b-tab title="Settings">
            <div>
              <p>Address: {{ address }}</p>
              <p>Private Key: {{ privateKey }}</p>
              <b-button @click="openPrivateKeyModal">Change Private Key</b-button>

              <b-modal ref="pk_modal" title="Set Your Private Key">
                <b-form-group horizontal :label-cols="12" label="Enter your private key">
                  <b-form-input v-model.trim="privateKey"></b-form-input>
                </b-form-group>
              </b-modal>
            </div>
          </b-tab>
        </b-tabs>

      </b-container>
    </div>

    <!-- Start running your app -->
    <script>
      window.app = new Vue({
        el: '#app',
        data: {
          wallet: null,
          privateKey: '',
          address: '',
          celoBalance: '0',
          cUsdBalance: '0',
          tfbBalance: '0',

        },
        async created() {
          var pk = localStorage.getItem('privateKey');
          if ( ! pk ) {
            pk = await tfbWallet.generatePrivateKey();
          }
          this.privateKey = pk;
          localStorage.setItem('privateKey', pk);
          this.wallet = await tfbWallet.getInstance(pk);
          this.address = await this.wallet.getAddress();
        },
        methods: {
          openPrivateKeyModal() {
            this.$refs['pk_modal'].show();
          },
          async privateKeyModalOK() {
            localStorage.setItem('privateKey', this.privateKey);
            tfbWallet.getInstance(this.privateKey).then(w => this.wallet = w);
            this.wallet = await tfbWallet.getInstance(pk);
            this.address = await this.wallet.getAddress();
          },
          privateKeyModalCancel() {
            this.privateKey = localStorage.getItem('privateKey') || '';
          },
        },
        computed: {

        }
      })
    </script>
  </body>
</html>
